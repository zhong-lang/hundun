#包含 "类型.头"


/* Hardware text mode color constants. */
枚举 显示器颜色 {
  黑色 = 0,
  蓝色 = 1,
  绿色 = 2,
  蓝绿色 = 3,
  红色 = 4,
  品红色 = 5,
  棕色 = 6,
  浅灰色 = 7,
  深灰色 = 8,
  浅蓝色 = 9,
  浅绿色 = 10,
  浅蓝绿色 = 11,
  浅红色 = 12,
  浅品红色 = 13,
  浅棕色 = 14,
  白色 = 15,
};

静态 内联 uint8_t 点的颜色(枚举 显示器颜色 前色, 枚举 显示器颜色 背景色)
{
  返回 前色 | 背景色 << 4;
}

静态 内联 uint16_t 点(unsigned 字符 字, uint8_t 颜色)
{
  返回 (uint16_t) 字 | (uint16_t) 颜色 << 8;
}

size_t 字符串长度(常量 字符* 字符串)
{
  size_t 甲 = 0;
  while (字符串[甲])
    甲++;
  return 甲;
}

静态 常量 size_t 显示器宽度 = 80;
静态 常量 size_t 显示器高度 = 25;

size_t 终端行数;
size_t 终端列数;
uint8_t 终端颜色;
uint16_t* 终端内存;

无 初始化终端(无)
{
  终端行数 = 0;
  终端列数 = 0;
  终端颜色 = 点的颜色(浅灰色, 黑色);
  终端内存 = (uint16_t*) 0xB8000;
  重复 (size_t y = 0; y < 显示器高度; y++) {
    for (size_t x = 0; x < 显示器宽度; x++) {
      常量 size_t 索引 = y * 显示器宽度 + x;
      终端内存[索引] = 点(' ', 终端颜色);
    }
  }
}

无 终端设置颜色(uint8_t 颜色)
{
  终端颜色 = 颜色;
}

无 终端写入字符到位置(字符 字, uint8_t 颜色, size_t x, size_t y)
{
	常量 size_t 索引 = y * 显示器宽度 + x;
	终端内存[索引] = 点(字, 颜色);
}

无 终端写入字符(字符 字)
{
  终端写入字符到位置(字, 终端颜色, 终端列数, 终端行数);
  if (++终端列数 == 显示器宽度) {
    终端列数 = 0;
    if (++终端行数 == 显示器高度)
      终端行数 = 0;
  }
}


无 终端写入(常量 字符* 字符串, size_t 长度)
{
	for (size_t i = 0; i < 长度; i++)
          终端写入字符(字符串[i]);
}
无 终端输出字符串(常量 字符* 字符串)
{
	终端写入(字符串, 字符串长度(字符串));
}

无 内核入口(无)
{
  初始化终端();

  常量 字符* 字符串 = \
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                  ===================================                          \n"
"                  =               ==                =                          \n"
"                  =               ==                =                          \n"
"                  =               ==                =                          \n"
"                  =               ==                =                          \n"
"                  ===================================                          \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n"
"                                  ==                                           \n";

  终端输出字符串(字符串);
}
